#include <HippoPlugin.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "../../../external/wrui_qt/c_api.h"

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static PU* g_ui = 0; 

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

typedef struct TestViewPlugin {
    struct PUWidget widget;
} TestViewPlugin;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void* test_view_create(HippoServiceAPI* services, PU* ui_funcs) {
    TestViewPlugin* plugin = malloc(sizeof(TestViewPlugin)); 
    memset(plugin, 0, sizeof(TestViewPlugin));
    g_ui = ui_funcs;

    plugin->widget = PU_create_widget(g_ui);
    
    PUWidget_show(plugin->widget);

    //plugin->widget = g_ui->create_widget(g_ui->priv_data);
    //plugin->widget.funcs->show(plugin->widget.priv_data);

    return plugin;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

int test_view_destroy(void* user_data) {
    TestViewPlugin* plugin = (TestViewPlugin*)user_data;
    free(plugin);
    return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void test_view_event(int event) {
    (void)event;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static HippoViewPlugin s_test_view = {
    HIPPO_VIEW_PLUGIN_API_VERSION,
    "TestView",
    "0.0.1",
    test_view_create,
    test_view_destroy,
    test_view_event,
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

HIPPO_EXPORT HippoViewPlugin* hippo_view_plugin() {
	return &s_test_view;
}

