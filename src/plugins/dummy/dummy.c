#include "../../plugin_api/HippoPlugin.h"
#include <stdlib.h>
#include <string.h>

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// This is a dummy plugin used as a reference and not inteded to do anything

typedef struct DummyPlugin {
	int dummy;
} DummyPlugin;

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static const char* dummy_info(void* user_data) {
	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static const char* dummy_supported_extensions() {
	return "";
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static const char* dummy_track_info(void* user_data) {
	return "unknown";
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

enum HippoProbeResult dummy_probe_can_play(const uint8_t* data, uint32_t data_size, const char* filename, uint64_t total_size) {
	return HippoProbeResult_Unsupported;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static void* dummy_create(struct HippoServiceAPI* services) {
	DummyPlugin* plugin = malloc(sizeof(DummyPlugin));
	memset(plugin, 0, sizeof(DummyPlugin));

	return plugin;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_open(void* user_data, const char* buffer) {
	DummyPlugin* plugin = (DummyPlugin*)user_data;
	(void)plugin;

	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_close(void* user_data) {
	DummyPlugin* plugin = (DummyPlugin*)user_data;
	(void)plugin;

	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_destroy(void* user_data) {
	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_read_data(void* user_data, void* dest) {
	DummyPlugin* plugin = (DummyPlugin*)user_data;
	(void)plugin;

	int16_t data[480 * 2] = { 0 };

	float* new_dest = (float*)dest;

	const float scale = 1.0f / 32768.0f;

	for (int i = 0; i < 480 * 2; ++i) {
		new_dest[i] = ((float)data[i]) * scale;
	}

	return 480;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_plugin_seek(void* user_data, int ms) {
	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_frame_size(void* user_data) {
    return 480 * 2;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static int dummy_length(void* user_data) {
	DummyPlugin* plugin = (DummyPlugin*)user_data;
	(void)plugin;
	return -10;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

static HippoPlaybackPlugin g_dummy_plugin = {
	1,
	dummy_probe_can_play,
	dummy_info,
	dummy_track_info,
	dummy_supported_extensions,
	dummy_create,
	dummy_destroy,
	dummy_open,
	dummy_close,
	dummy_read_data,
	dummy_plugin_seek,
	dummy_frame_size,
	dummy_length,
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

HIPPO_EXPORT HippoPlaybackPlugin* getPlugin() {
	return &g_dummy_plugin;
}


